<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="quadkeyr">
<title>From a QuadKey to a Simple Features data.frame and other conversions • quadkeyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="From a QuadKey to a Simple Features data.frame and other conversions">
<meta property="og:description" content="quadkeyr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">quadkeyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/quadkey_to_sf_conversion.html">From a QuadKey to a Simple Features data.frame and other conversions</a>
    <a class="dropdown-item" href="../articles/quadkey_identified_data_to_raster.html">Generating a Raster Image from Quadkey-Identified Data</a>
    <a class="dropdown-item" href="../articles/facebook_mobility_csvs_to_raster_files.html">Converting Facebook Mobility QuadKey-identified Datasets into Raster Files</a>
    <a class="dropdown-item" href="../articles/quadkey_visualization_app.html">QuadKey Visualization App</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Fernandez-Lab-WSU/quadkeyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>From a QuadKey to a Simple Features data.frame and other conversions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Fernandez-Lab-WSU/quadkeyr/blob/HEAD/vignettes/quadkey_to_sf_conversion.Rmd" class="external-link"><code>vignettes/quadkey_to_sf_conversion.Rmd</code></a></small>
      <div class="d-none name"><code>quadkey_to_sf_conversion.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>Please, visit the <a href="https://fernandez-lab-wsu.github.io/quadkeyr/" class="external-link">README</a> for
general information about this package</p>
</blockquote>
<p>Most of the function and arguments names conserved from the
documentation. <code>quadkeyr</code> functions are the R version of the
ones described in <a href="https://learn.microsoft.com/en-us/bingmaps/articles/bing-maps-tile-system" class="external-link">Bing
Maps Tile System webpage</a>.</p>
<div class="section level2">
<h2 id="basic-workflow">Basic workflow<a class="anchor" aria-label="anchor" href="#basic-workflow"></a>
</h2>
<p><img src="../reference/figures/workflow_quadkey.png" width="90%" style="display: block; margin: auto;"></p>
<p>You can convert any QuadKey to a <a href="https://r-spatial.github.io/sf/articles/sf1.html#sf-objects-with-simple-features" class="external-link">Simple
Features object</a> <code>sf POINT data.frame</code> or
<code>sf POLYGON data.frame</code> using the functions
<code>quadkey_to_latlong</code> and <code>quadkey_to_polygon</code>.
It’s important to notice that the geographic coordinates of the point
will always correspond to the upper-left corner of the polygon for the
same QuadKey.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qtll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadkey_to_latlong.html">quadkey_to_latlong</a></span><span class="op">(</span><span class="st">"2103"</span><span class="op">)</span></span>
<span><span class="va">qtll</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -67.5 ymin: -21.94305 xmax: -67.5 ymax: -21.94305</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   quadkey                geometry</span></span>
<span><span class="co">#&gt; 1    2103 POINT (-67.5 -21.94305)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadkey_to_polygon.html">quadkey_to_polygon</a></span><span class="op">(</span><span class="st">"2103"</span><span class="op">)</span></span>
<span><span class="va">qtp</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -67.5 ymin: -40.9799 xmax: -45 ymax: -21.94305</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   quadkey                       geometry</span></span>
<span><span class="co">#&gt; 1    2103 POLYGON ((-67.5 -40.9799, -...</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qtp</span>, color <span class="op">=</span> <span class="st">'red'</span>, fill <span class="op">=</span> <span class="cn">NA</span>, linewidth <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">qtll</span>, color <span class="op">=</span> <span class="st">'blue'</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"QuadKey"</span>, <span class="va">qtll</span><span class="op">$</span><span class="va">quadkey</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="quadkey_to_sf_conversion_files/figure-html/qk-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="advanced-use">Advanced use<a class="anchor" aria-label="anchor" href="#advanced-use"></a>
</h2>
<p>The conversion from QuadKey to geographic coordinates involves a
series of smaller transformations that relate to the structure of Tile
Maps. All of these intermediary functions, as well as those facilitating
the reverse conversion, are available for use within the
<code>quadkeyr</code> package.</p>
<div class="section level3">
<h3 id="tile-maps-quadkeys-tiles-pixels-and-geographic-coordinates">Tile Maps: QuadKeys, tiles, pixels and geographic coordinates<a class="anchor" aria-label="anchor" href="#tile-maps-quadkeys-tiles-pixels-and-geographic-coordinates"></a>
</h3>
<blockquote>
<p>Note: In the official documentation, the term ‘level of detail’ is
equivalent to what is here referred to as ‘zoom level’.</p>
</blockquote>
<p>Tile maps are composed of pixels that are grouped into tiles. Later,
the tiles are converted to QuadKeys to optimize map performance, among
other benefits described in detail in <a href="https://learn.microsoft.com/en-us/bingmaps/articles/bing-maps-tile-system" class="external-link">the
documentation</a>.</p>
<p>Pixels and tiles are expressed as two-dimensional coordinates -
(<code>pixelX</code>, <code>pixelY</code>) and (<code>tileX</code>,
<code>tileY</code>) - but Quadkeys are one-dimensional numeric strings.
This is important to understand how the conversion works.</p>
<p>Each geographic pair of coordinates (latitude/longitude) will belong
to a specific pixel referenced by coordinates (<code>pixelX</code>,
<code>pixelY</code>) for each zoom level. In Fig. 1, you can see pixels
(0, 0) and (2047, 2047) for zoom level 3. The <code>quadkeyr</code>
function <code>latlong_to_pixelXY</code>, converts geographic
coordinates (latitude/longitude) in pixel coordinates for each zoom
level.</p>
<div class="figure" style="text-align: center">
<img src="bing_pixel.jpg" alt="Fig 1. Pixels (0, 0) and (2047, 2047) for a map with zoom level 3. Image extracted from Microsoft's Bing Maps Tile System webpage." width="50%"><p class="caption">
Fig 1. Pixels (0, 0) and (2047, 2047) for a map with zoom level 3. Image
extracted from Microsoft’s Bing Maps Tile System webpage.
</p>
</div>
<p>In turn, a tile is comprised of 256x256 pixels. The tile coordinates
are visually represented in Fig. 2. These coordinates will ultimately be
converted into one-dimensional QuadKeys.</p>
<p>For instance, a pixel for zoom level 3 represented by the coordinates
<code>pixelX</code> = 255 and <code>pixelY</code> = 12 is part of the
tile with coordinates <code>tileX</code> = 0 and <code>tileY</code> = 0.
The pixel with coordinates (0,0) belongs to tile (0,0), and the pixel
(2047, 2047) is part of tile (7,7). You can verify this using the
function <code>pixelXY_to_tileXY</code> and by comparing Fig. 1 and Fig.
2.</p>
<div class="figure" style="text-align: center">
<img src="bing_tiles.jpg" alt="Fig 2. Tile coordinates. Image extracted from Microsoft's Bing Maps Tile System webpage." width="50%"><p class="caption">
Fig 2. Tile coordinates. Image extracted from Microsoft’s Bing Maps Tile
System webpage.
</p>
</div>
<p>To convert from tile XY coordinates to QuadKeys for a particular zoom
level, you can use the function <code>tileXY_to_quadkey</code>. The
number of digits of the QuadKey will correspond to the zoom level of the
map. For example, for the tile (4, 7) of zoom level 3, the QuadKey will
be <code>322</code>.</p>
<p>This pertains to the conversion from geographic coordinates
(latitude/longitude) to QuadKeys. However, when converting in the
opposite direction, from QuadKeys to geographic coordinates
(latitude/longitude), the final pair of latitude/longitude corresponds
to the upper-left corner coordinates of the tile and pixel associated
with your original QuadKey.</p>
<p>To understand this in more detail, have a look to the functions and
then read section 3.</p>
</div>
<div class="section level3">
<h3 id="if-you-have-a-pair-of-geographic-map-coordinates-convert-them-to-a-quadkey">If you have a pair of geographic map coordinates, convert them to a
QuadKey<a class="anchor" aria-label="anchor" href="#if-you-have-a-pair-of-geographic-map-coordinates-convert-them-to-a-quadkey"></a>
</h3>
<p><strong>Geographic coordinates</strong> <span>→</span> <strong>pixel
XY coordinates</strong> <span>→</span> <strong>tile XY
coordinates</strong> <span>→</span> <strong>QuadKey</strong></p>
<blockquote>
<p>Note: The latitude and longitude coordinates are in the WGS 84
reference system.</p>
</blockquote>
<div class="section level4">
<h4 id="convert-latitudelongitude-coordinates-to-pixel-xy-coordinates">Convert latitude/longitude coordinates to pixel XY coordinates<a class="anchor" aria-label="anchor" href="#convert-latitudelongitude-coordinates-to-pixel-xy-coordinates"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lltp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latlong_to_pixelXY.html">latlong_to_pixelXY</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="op">-</span><span class="fl">25</span>, </span>
<span>                           lon <span class="op">=</span> <span class="op">-</span><span class="fl">53</span>, </span>
<span>                           zoom <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">lltp</span></span>
<span><span class="co">#&gt; $pixelX</span></span>
<span><span class="co">#&gt; [1] 1445</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $pixelY</span></span>
<span><span class="co">#&gt; [1] 2342</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="convert-pixel-xy-coordinates-into-tile-xy-coordinates">Convert pixel XY coordinates into tile XY coordinates<a class="anchor" aria-label="anchor" href="#convert-pixel-xy-coordinates-into-tile-xy-coordinates"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pixelXY_to_tileXY.html">pixelXY_to_tileXY</a></span><span class="op">(</span>pixelX <span class="op">=</span> <span class="va">lltp</span><span class="op">$</span><span class="va">pixelX</span>,</span>
<span>                         pixelY <span class="op">=</span> <span class="va">lltp</span><span class="op">$</span><span class="va">pixelY</span><span class="op">)</span></span>
<span><span class="va">ptt</span></span>
<span><span class="co">#&gt; $tileX</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tileY</span></span>
<span><span class="co">#&gt; [1] 9</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="convert-tile-xy-coordinates-into-a-quadkey">Convert tile XY coordinates into a QuadKey<a class="anchor" aria-label="anchor" href="#convert-tile-xy-coordinates-into-a-quadkey"></a>
</h4>
<p>This function returns the QuadKey string. Since we are estimating
zoom level 4, the number consists of 4 digits.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tileXY_to_quadkey.html">tileXY_to_quadkey</a></span><span class="op">(</span>tileX <span class="op">=</span> <span class="va">ptt</span><span class="op">$</span><span class="va">tileX</span>,</span>
<span>                  tileY <span class="op">=</span> <span class="va">ptt</span><span class="op">$</span><span class="va">tileY</span>,</span>
<span>                  zoom <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2103"</span></span></code></pre></div>
<p>The function <code>latlong_to_quadkey</code> wraps the last three
functions, and converts map coordinates into a QuadKey for a particular
zoom level:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/latlong_to_quadkey.html">latlong_to_quadkey</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="op">-</span><span class="fl">25</span>,</span>
<span>                   lon <span class="op">=</span> <span class="op">-</span><span class="fl">53</span>,</span>
<span>                   zoom <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -53 ymin: -25 xmax: -53 ymax: -25</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   quadkey        geometry</span></span>
<span><span class="co">#&gt; 1    2103 POINT (-53 -25)</span></span></code></pre></div>
<p>This function also work for multiple coordinates:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/latlong_to_quadkey.html">latlong_to_quadkey</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="op">-</span><span class="fl">25.33</span>, <span class="op">-</span><span class="fl">25.66</span><span class="op">)</span>,</span>
<span>                   lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">53</span>, <span class="op">-</span><span class="fl">60.33</span>, <span class="op">-</span><span class="fl">70.66</span><span class="op">)</span>,</span>
<span>                   zoom <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 3 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -70.66 ymin: -25.66 xmax: -53 ymax: -4</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   quadkey              geometry</span></span>
<span><span class="co">#&gt; 1    2101        POINT (-53 -4)</span></span>
<span><span class="co">#&gt; 2    2103 POINT (-60.33 -25.33)</span></span>
<span><span class="co">#&gt; 3    2102 POINT (-70.66 -25.66)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="if-you-have-a-quadkeys-convert-them-to-a-pair-of-map-coordinates">If you have a QuadKeys, convert them to a pair of map
coordinates<a class="anchor" aria-label="anchor" href="#if-you-have-a-quadkeys-convert-them-to-a-pair-of-map-coordinates"></a>
</h3>
<p>Let’s attempt the reverse route.</p>
<p><strong>QuadKey</strong> <span>→</span> <strong>tile XY
coordinates</strong> <span>→</span> <strong>pixel XY
coordinates</strong> <span>→</span> <strong>Geographic
coordinates</strong></p>
<div class="section level4">
<h4 id="convert-a-quadkey-into-tile-xy-coordinates">Convert a QuadKey into tile XY coordinates<a class="anchor" aria-label="anchor" href="#convert-a-quadkey-into-tile-xy-coordinates"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qtt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadkey_to_tileXY.html">quadkey_to_tileXY</a></span><span class="op">(</span><span class="st">"2103"</span><span class="op">)</span></span>
<span><span class="va">qtt</span></span>
<span><span class="co">#&gt; $tileX</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tileY</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $zoom</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="convert-tile-xy-coordinates-into-pixel-xy-coordinates">Convert tile XY coordinates into pixel XY coordinates<a class="anchor" aria-label="anchor" href="#convert-tile-xy-coordinates-into-pixel-xy-coordinates"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ttp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tileXY_to_pixelXY.html">tileXY_to_pixelXY</a></span><span class="op">(</span>tileX <span class="op">=</span> <span class="va">qtt</span><span class="op">$</span><span class="va">tileX</span>,</span>
<span>                         tileY <span class="op">=</span> <span class="va">qtt</span><span class="op">$</span><span class="va">tileY</span><span class="op">)</span></span>
<span><span class="va">ttp</span></span>
<span><span class="co">#&gt; $pixelX</span></span>
<span><span class="co">#&gt; [1] 1280</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $pixelY</span></span>
<span><span class="co">#&gt; [1] 2304</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="convert-pixel-xy-coordinates-into-latlong-coordinates">Convert pixel XY coordinates into lat/long coordinates<a class="anchor" aria-label="anchor" href="#convert-pixel-xy-coordinates-into-latlong-coordinates"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pixelXY_to_latlong.html">pixelXY_to_latlong</a></span><span class="op">(</span>pixelX <span class="op">=</span> <span class="va">ttp</span><span class="op">$</span><span class="va">pixelX</span>,</span>
<span>                           pixelY <span class="op">=</span> <span class="va">ttp</span><span class="op">$</span><span class="va">pixelY</span>,</span>
<span>                           zoom <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ptll</span></span>
<span><span class="co">#&gt; $lat</span></span>
<span><span class="co">#&gt; [1] -21.94305</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lon</span></span>
<span><span class="co">#&gt; [1] -67.5</span></span></code></pre></div>
<p>You can also use the function <code>quadkey_to_latlong</code> that
wraps the last 3 functions and returns a
<code>sf POINT data.frame</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/quadkey_to_latlong.html">quadkey_to_latlong</a></span><span class="op">(</span><span class="st">"2103"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -67.5 ymin: -21.94305 xmax: -67.5 ymax: -21.94305</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   quadkey                geometry</span></span>
<span><span class="co">#&gt; 1    2103 POINT (-67.5 -21.94305)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="caveats-when-converting-coordinates">Caveats when converting coordinates<a class="anchor" aria-label="anchor" href="#caveats-when-converting-coordinates"></a>
</h3>
<p>Given the process of converting geographic coordinates
(latitude/longitude) to QuadKeys, one might expect that the conversion
back to latitude/longitude coordinates (as in section 2.3) would yield
the same values as the original input in section 1.</p>
<p>However, this isn’t the case, as evidenced by the behavior of the
functions <code>pixelXY_to_tileXY</code> and
<code>tileXY_to_pixel_XY</code>.</p>
<p>When choosing latitude/longitude coordinates in the initial function
in section 1, they were within a specific pixel represented by unique
tile coordinates and a QuadKey number. As you can see in the example in
this vignette, the conversion back from QuadKey to latitude/longitude
does not directly result in the same initial geographic coordinates.</p>
<p>This discrepancy arises because <code>tileXY_to_pixel_XY</code>
provides the pixel coordinates for the upper-left corner of the tile,
not the exact coordinates chosen initially. For example, if you run
<code>tileXY_to_pixelXY</code> for the tile (7, 7), you will see that
the resulting pixel is (1792, 1792) and no (2047, 2047) the one you
could see in Fig. 2. As each tile is 256x256 pixels, you can easily
check that the result is the upper-left pixel of that tile. The same
will happen for <code>pixelXY_to_latlong</code>.</p>
<p>Hence, converting latitude/longitude coordinates into a QuadKey and
then back to latitude/longitude won’t yield identical values, unless the
original latitude/longitude coordinates correspond to the upper-left
pixel of the tile at the same zoom level. You can try this by
yourself.</p>
<p>Consider as initial values the coordinates result of the conversion
from QuadKey to latitude/longitude obtained in section 2.3 (lat =
-21.94305, lon = -67.5) and rerun all functions from the beginning.
You’ll proof this way that obtaining the original geographic coordinates
is unlikely unless the initial coordinates correspond to the upper-left
pixel of the tile.</p>
<p>Understanding this distinction is crucial for the accurate use of
these functions in coordinate conversions.</p>
</div>
<div class="section level3">
<h3 id="additional-functions">Additional functions<a class="anchor" aria-label="anchor" href="#additional-functions"></a>
</h3>
<p>In addition to the conversion functions mentioned earlier, the
<code>quadkeyr</code> package also includes the following functions:
<code>mapsize</code>, <code>mapscale</code>, and
<code>ground_res</code>. These functions are described on the <a href="https://learn.microsoft.com/en-us/bingmaps/articles/bing-maps-tile-system" class="external-link">Bing
Maps Tile System webpage</a> and are available for its use.</p>
</div>
</div>
<div class="section level2">
<h2 id="quadkey-map-visualizer-app">QuadKey map visualizer app<a class="anchor" aria-label="anchor" href="#quadkey-map-visualizer-app"></a>
</h2>
<p>You can visualize the QuadKey location in the map using the app
included in this package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/qkmap_app.html">qkmap_app</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="qkmap_qk.png" width="90%" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Florencia D’Andrea.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
